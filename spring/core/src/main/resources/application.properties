# ===============================================================
# IMPORT EXTERNAL CONFIGURATION
# ===============================================================
# Load the internal defaults, then import and override with reveila.properties
spring.config.import=optional:file:${system.home}/configs/reveila.properties

# ===============================================================
# CORE & PERFORMANCE
# ===============================================================
server.port=8080
spring.application.name=Reveila-Spring
# Project Loom support for high-concurrency API routing
spring.threads.virtual.enabled=true
spring.profiles.active=prod

# ===============================================================
# PERSISTENCE: JPA / H2 (Development Profile)
# ===============================================================

# For Docker Network, use the service name defined in docker-compose.prod.yml (e.g., 'reveila-db-prod').
spring.datasource.url=jdbc:postgresql://reveila-db-prod:5432/reveila_db
# For local development without Docker, use localhost and ensure PostgreSQL is running locally with the correct credentials.
# spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:5432/reveila_db
spring.datasource.username=${DB_USER:admin}
spring.datasource.password=${DB_PASSWORD:6788565119}
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update

# Use H2 in-memory database for quick testing and development
# spring.h2.console.enabled=true
# spring.datasource.url=jdbc:h2:mem:reveila_db;DB_CLOSE_DELAY=-1
# spring.datasource.driver-class-name=org.h2.Driver
# spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
# spring.datasource.username=sa
# spring.datasource.password=

# 2. Critical for Persistence: Do NOT use 'create-drop'
# Use 'update' to add new columns/tables without deleting data
# Use 'validate' in production-like environments to ensure schema matches entities
# spring.jpa.hibernate.ddl-auto=update
# spring.jpa.hibernate.ddl-auto=validate

# Optional: Show SQL to verify tables are being created correctly
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# ===============================================================
# PERSISTENCE: MONGODB (Atlas Cluster)
# ===============================================================
# Mongo Database Connection String = mongodb+srv://cc2lee:<db_password>@cluster0.emzc59r.mongodb.net/?appName=Cluster0
## spring.data.mongodb.uri=mongodb+srv://cc2lee:${MONGO_PWD}@cluster0.emzc59r.mongodb.net/?appName=Cluster0
# If local, use mongodb://localhost:27017/testdb
# Disable Mongo health check from the Actuator
## management.health.mongo.enabled=false
# Mongo Database Name
## spring.data.mongodb.database=reveila_dev

# ===============================================================
# JSON & SERIALIZATION (Critical for EntityMapper)
# ===============================================================
# Ensure dates are readable in the Vue frontend
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.default-property-inclusion=non_null

# ===============================================================
# LOGGING & MONITORING
# ===============================================================
# Set the overall root level to something sane
logging.level.root=INFO

# Keep your custom business logic at a detailed level
logging.level.com.reveila=DEBUG

# SPECIFICALLY SILENCE THE TOMCAT NOISE
# These packages are responsible for the 'timeout completed' logs
logging.level.org.apache.tomcat=INFO
logging.level.org.apache.catalina=INFO
logging.level.org.apache.coyote=INFO

# If you are using Spring's default logging, this helps too
logging.level.org.springframework.web=INFO

# Print out the SQL statements and bindings for debugging
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Enable Spring Boot Actuator Endpoints
management.endpoint.health.enabled=true
management.endpoint.info.enabled=true
management.endpoint.metrics.enabled=true
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always

# Customize the Actuator's health check details
management.health.mongo.enabled=true
management.health.db.enabled=true
management.health.diskspace.enabled=true
management.health.diskspace.path=${system.data.file.dir}
management.health.diskspace.threshold=10MB
management.health.ping.enabled=true
management.health.ping.response=Reveila is alive and well!

# Customize the info endpoint
management.info.env.enabled=true
management.info.app.name=${system.name}
management.info.app.version=${system.version}
management.info.app.description=Reveila Spring Boot Application

# Customize metrics
management.metrics.export.simple.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.percentiles.http.server.requests=0.5,0.9,0.99

# ===============================================================
# WEB & DEVTOOLS (VUE.JS INTEGRATION)
# ===============================================================
# Disable caching so changes are visible immediately in the browser
spring.web.resources.cache.period=0
spring.thymeleaf.cache=false

# Tell DevTools to watch the new runtime web directory for changes
spring.devtools.restart.additional-paths=${system.home}/web

# End of application.properties
